import React from 'react';
import { Routes, Route, Navigate } from 'react-router-dom';
import { Layout } from '../components/layout';
import { LoginPage } from '../modules/login';
import { DashboardPage } from '../modules/dashboard';
import SubAdminManagement from '../modules/subadmin/SubAdminsPage';
import { VendorManagement } from '../modules/vendors';
import { CustomerManagement } from '../modules/customers';
import VendorOwnerDashboard from '../modules/dashboard/dashboards/VendorOwnerDashboard';
import CategoriesPage from '../modules/categories/CategoriesPage';
import ProductsPage from '../modules/products/ProductsPage';
import OrdersPage from '../modules/orders/OrdersPage';
import RidersPage from '../modules/riders/RidersPage';
import VehicleTypesPage from '../modules/vehicles/VehicleTypesPage';
import { SubCategoriesPage } from '../modules/subcategories';
import BrandsPage from '../modules/brands/BrandsPage';


//vendor routes
import VendorProductPage from '../modules/vendor_products/VendorProductsPage';

// Simple ProtectedRoute component
const ProtectedRoute = ({ children, allowedRoles = ["ALL"] }) => {
    const isAuthenticated = localStorage.getItem('isAuthenticated') === 'true';
    const userRole = localStorage.getItem('userRole') || 'SUPER_ADMIN';

    if (!isAuthenticated) {
        return <Navigate to="/login" replace />;
    }

    if (!allowedRoles.includes("ALL") && !allowedRoles.includes(userRole)) {
        return <Navigate to="/" replace />;
    }

    return <Layout>{children}</Layout>;
};

const GlobalRoutes = () => {
    return (
        <Routes>
            {/* Public Routes */}
            <Route path="/login" element={<LoginPage />} />

            {/* Protected Routes - Wrapped in Layout */}
            <Route
                path="/"
                element={
                    <ProtectedRoute>
                        <DashboardPage />
                    </ProtectedRoute>
                }
            />

            <Route path="/users" element={<Navigate to="/subadmin" replace />} />
            <Route
                path="/subadmin"
                element={
                    <ProtectedRoute allowedRoles={["ALL", "SUPER_ADMIN", "ADMIN", "SUB_ADMIN"]}>
                        <SubAdminManagement />
                    </ProtectedRoute>
                }
            />

            <Route
                path="/vendors"
                element={
                    <ProtectedRoute allowedRoles={["SUPER_ADMIN", "ADMIN"]}>
                        <VendorManagement />
                    </ProtectedRoute>
                }
            />

            <Route
                path="/categories"
                element={
                    <ProtectedRoute allowedRoles={["SUPER_ADMIN", "ADMIN"]}>
                        <CategoriesPage />
                    </ProtectedRoute>
                }
            />

            <Route
                path="/sub-categories"
                element={
                    <ProtectedRoute allowedRoles={["SUPER_ADMIN", "ADMIN"]}>
                        <SubCategoriesPage />
                    </ProtectedRoute>
                }
            />
            <Route
                path="/brands"
                element={
                    <ProtectedRoute allowedRoles={["SUPER_ADMIN", "ADMIN"]}>
                        <BrandsPage />
                    </ProtectedRoute>
                }
            />

            <Route
                path="/products"
                element={
                    <ProtectedRoute allowedRoles={["SUPER_ADMIN", "ADMIN", "VENDOR", "VENDOR_MANAGER"]}>
                        <ProductsPage />
                    </ProtectedRoute>
                }
            />

            <Route
                path="/orders"
                element={
                    <ProtectedRoute allowedRoles={["SUPER_ADMIN", "ADMIN", "VENDOR", "VENDOR_MANAGER"]}>
                        <OrdersPage />
                    </ProtectedRoute>
                }
            />

            <Route
                path="/vendors/:id"
                element={
                    <ProtectedRoute allowedRoles={["SUPER_ADMIN", "ADMIN"]}>
                        <VendorOwnerDashboard />
                    </ProtectedRoute>
                }
            />

            <Route
                path="/riders"
                element={
                    <ProtectedRoute allowedRoles={["SUPER_ADMIN", "ADMIN"]}>
                        <RidersPage />
                    </ProtectedRoute>
                }
            />

            <Route
                path="/vehicles"
                element={
                    <ProtectedRoute allowedRoles={["SUPER_ADMIN", "ADMIN"]}>
                        <VehicleTypesPage />
                    </ProtectedRoute>
                }
            />

            <Route
                path="/customers"
                element={
                    <ProtectedRoute allowedRoles={["SUPER_ADMIN", "ADMIN", "SUB_ADMIN"]}>
                        <CustomerManagement />
                    </ProtectedRoute>
                }
            />

            <Route
                path="/vendor-products"
                element={
                    <ProtectedRoute allowedRoles={["SUPER_ADMIN", "ADMIN", "SUB_ADMIN", "VENDOR_OWNER"]}>
                        <VendorProductPage />
                    </ProtectedRoute>
                }
            />

            {/* Fallback route */}
            <Route path="*" element={<Navigate to="/" replace />} />
        </Routes>
    );
};

export default GlobalRoutes;
